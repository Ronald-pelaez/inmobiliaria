name: Actualizar versión en GitBook

on:
  push:
    tags:
      - 'v*.*.*'  # Detecta etiquetas de versión en el formato v1.0.0, v2.1.0, etc.

jobs:
  deploy_gitbook:
    runs-on: windows-latest  # Especifica el entorno de Windows

    steps:
      - name: Configurar Git
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

      - name: Clonar el repositorio
        uses: actions/checkout@v2

      - name: Publicar en GitBook usando PowerShell
        env:
          GITBOOK_TOKEN: ${{ secrets.GITBOOK_TOKEN }}
        shell: pwsh
        run: |
          $version = git describe --tags
          Write-Output "Version: $version"

          # Define los encabezados y el contenido JSON para la solicitud
          $headers = @{
              Authorization = "Bearer $env:GITBOOK_TOKEN"
              "Content-Type" = "application/json"
          }
          $body = @{
              title = "Versión $version"
              description = "Documentación actualizada para la versión $version"
              status = "published"
          } | ConvertTo-Json

          # Envía la solicitud HTTP POST a GitBook
          Invoke-RestMethod -Uri "https://api.gitbook.com/v1/spaces/2MQHVPylci67MSGgaNm5/documents" -Method Post -Headers $headers -Body $body
